<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to write a PHP Youtube video downloader | Saeed's Blog</title><meta name=keywords content><meta name=description content="PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won&rsquo;t go through those ways and will stick to single threading."><meta name=author content="Saeed"><link rel=canonical href=https://keyboardsmash.dev/posts/how-download-youtube-videos-by-php/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://keyboardsmash.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keyboardsmash.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keyboardsmash.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://keyboardsmash.dev/apple-touch-icon.png><link rel=mask-icon href=https://keyboardsmash.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PD18QTF1JJ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PD18QTF1JJ",{anonymize_ip:!1})}</script><meta property="og:title" content="How to write a PHP Youtube video downloader"><meta property="og:description" content="PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won&rsquo;t go through those ways and will stick to single threading."><meta property="og:type" content="article"><meta property="og:url" content="https://keyboardsmash.dev/posts/how-download-youtube-videos-by-php/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-16T21:37:50+08:00"><meta property="article:modified_time" content="2020-04-16T21:37:50+08:00"><meta property="og:site_name" content="Saeed's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to write a PHP Youtube video downloader"><meta name=twitter:description content="PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won&rsquo;t go through those ways and will stick to single threading."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://keyboardsmash.dev/posts/"},{"@type":"ListItem","position":3,"name":"How to write a PHP Youtube video downloader","item":"https://keyboardsmash.dev/posts/how-download-youtube-videos-by-php/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to write a PHP Youtube video downloader","name":"How to write a PHP Youtube video downloader","description":"PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won\u0026rsquo;t go through those ways and will stick to single threading.","keywords":[],"articleBody":"PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won’t go through those ways and will stick to single threading.\nAt the end of this article, we have a command called dl, and it gets a Youtube video URL to download.\n$ php index.php dl https://www.youtube.com/watch?v=XXXXXXXXX Video formats 1: video/mp4; codecs=\"avc1.640028\" - 39013359 2: video/webm; codecs=\"vp9\" - 35592706 3: video/mp4; codecs=\"av01.0.08M.08\" - 33395130 4: video/mp4; codecs=\"avc1.4d401f\" - 9282564 5: video/webm; codecs=\"vp9\" - 11742153 6: video/mp4; codecs=\"av01.0.05M.08\" - 19186717 7: video/mp4; codecs=\"avc1.4d401e\" - 5689359 8: video/webm; codecs=\"vp9\" - 6911794 9: video/mp4; codecs=\"av01.0.04M.08\" - 8974711 10: video/mp4; codecs=\"avc1.4d401e\" - 4401516 Which format do you want to download? (default: 1):10 Connected... Mime-type: video/mp4 Filesize: 4401516 [==============================================\u003e] 100% ( 4/ 4 mb) What we will learn by the end of this article: How to create a command-line application How to use the Factory design pattern How to get information about a Youtube video such as formats, titles, etc. How to download a file with PHP with a progress bar Create the project create a new directory and run composer init inside it:\n$ mkdir youtueb-downloader \u0026\u0026 cd youtueb-downloader $ composer init After running composer init‍ you need to answer a few questions. This command creates a composer.json file inside youtube-downloader directory.\nInstall dependencies $ composer require symfony/console $ composer require smoqadam/youtube-video-info:dev-master symfony/console is a great package that helps us to create a command-line application and make it easier to handle input and outputs.\nsmoqadam/youtube-video-info gives us information about a Youtube video. The information such as video formats, subtitles, download URL, title, etc.\nautoloading Create a directory and call it src we will put all of our classes inside this directory. For taking advantage of composer autloading, open composer.json and add autoload sectoin such as below:\n{ \"autoload\": { \"psr-4\": { \"Downloader\\\\\": \"src\" } } } Downloader is our chosen namespace for this project, and whenever the composer wants to load a class within this namespace, it looks inside the src directory.\nYou can find more information about PSR4 here.\nHandle Command Line arguments Create a Download.php file inside the src/Commands directory and with the following content:\n\u003c?php // src/Commands/Download.php namespace Downloader\\Commands; use Downloader\\Downloader; use Downloader\\Factory; use Symfony\\Component\\Console\\Command\\Command; use Symfony\\Component\\Console\\Input\\InputArgument; use Symfony\\Component\\Console\\Input\\InputInterface; use Symfony\\Component\\Console\\Output\\OutputInterface; class Download extends Command { protected static $defaultName = \"dl\"; private $arg = 'url'; protected function configure() { $this-\u003esetDescription(\"URL\")-\u003eaddArgument($this-\u003earg, InputArgument::REQUIRED); } protected function execute(InputInterface $input, OutputInterface $output) { $url = $input-\u003egetArgument($this-\u003earg); echo $outpu-\u003ewrite(\"{$url}\") return 0; } } Download class extended Command from the symfony/console package, which gives us many features to handle command-line input and outputs.\n$defaultName is the name of our command. configure method is using to config our command, such as add description, add arguments, options, and so on. Inside the configure method, we can configure the dl command, for example, add a description, add arguments, options, and many more. And finally, execute will call when we run the dl command from CLI. It receives two parameters, $input for handling the inputs such as options and arguments, and $output for managing the output. As you can see, we used tags in the write method to colorize the output. Let’s make our dl command work by creating a index.php file under root directory:\n\u003c?php // index.php use Downloader\\Commands\\Download; use Symfony\\Component\\Console\\Application; require_once 'vendor/autoload.php'; // Symfony/console application $app = new Application(); $app-\u003eadd(new Download()); $app-\u003erun(); Application is the main class responsible for handling the command line application, so to make our dl command work, we must use the add method to pass a new instance of Download class to it.\nNow, open your terminal and run the following command:\n$ PHP index.php dl http://example.com you should see http://example.com in green color as output.\nDownloader In this section, we are going to make a downloader class. This class receives a URL and a file name, and it will download the file for us. But before we create our Downloader class, let’s think about how we can make it extendable? By extendable, I mean how we can have a Downloader that downloads files from different sources such as Youtube or Vimeo videos or may a direct link.\nWe know that Youtube videos have different qualities, and each quality has a different download link. So before we can download a video, we must get all qualities and ask users which quality they want to download. But this process will be different if they’re going to download from Vimeo or a direct link.\nIn the SOLID principle, S is for Single responsibility, which means each class must do only one thing. With that explanation, we need to have different classes for different sources.\nTo achieve this, we can use Factory design pattern to instantiate a new object based on the URL that the user wants to download.\nFor example, if it was a Youtube URL, it will return a new object from Youtube class and so on.\nFactory.php class under src/ directory would be something like this:\n\u003c?php // src/Factory.php namespace Downloader; class Factory { public static function make(string $url): ProviderAbstract { switch (true) { case preg_match('%(?:youtube(?:-nocookie)?\\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?\u0026]v=)|youtu\\.be/)([^\"\u0026?/ ]{11})%i', $url, $matches): return new Youtube($url); default: throw new Exception(\"Download link does not support\"); } } } Factory Design pattern is creational pattern that create a different object based on some conditions. In our case, we checked the $url and if it was a Yoututbe link, it returns a new instance of Yoututbe class, otherwise it throws an Exception.\nHandle different sources As we saw earlier, we decided to let our app download from different sources, but these sources or providers must follow some rules to prevent chaos and make it easier to extend and debug. We define our rules inside ProviderAbstract, and every provider (e.g., Youtube class) must extend from this class, and they must implement the init method.\nProviderAbstract // src/ProviderAbstract.php \u003c?php namespace Downloader; abstract class ProviderAbstract { protected $url; protected $name; public function __construct($url) { $this-\u003einit($url); } public function getUrl(): string { return $this-\u003eurl; } public function getName(): string { return $this-\u003ename; } abstract public function init(string $url): void; } Every provider must initialize and prepare the download link and output file name inside the init method.\nYoutube provider Create a directory under src and call it Providers then create a file Youtube.php inside it:\n\u003c?php // src/Providers/Youtube.php namespace Downloader\\Providers; use Downloader\\ProviderAbstract; use Smoqadam\\Video; class Youtube extends ProviderAbstract { protected $pattern = '%(?:youtube(?:-nocookie)?\\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?\u0026]v=)|youtu\\.be/)([^\"\u0026?/ ]{11})%i'; public function init(string $url): void { $video = new Video($this-\u003egetVideoId($url)); // fetch all formats and qualities $formats = $video-\u003egetFormats(); print(\"\\nVideo formats\"); // print a simple menu by each quality in a new line foreach ($formats as $index =\u003e $format) { printf(\"\\n%d: %s - %d\", $index + 1, $format-\u003egetMimeType(), $format-\u003egetSize()); } // wait for user to enter index number associated to a menu item printf(\"\\nWhich format do you want to download? (default: 1):\"); $i = readline(); if (!$i) { $i = 1; } $format = $formats[$i - 1]; // set url and name $this-\u003eurl = $format-\u003egetUrl(); $this-\u003ename = $video-\u003egetDetails()-\u003egetTitle(); } private function getVideoId($url) { preg_match($this-\u003epattern, $url, $match); return $match[1]; } } Youtube class extended from ProviderAbstract, which means it must implement the init method. Inside init, we took advantage of smoqadam/youtube-video-info package to parse a youtube video. Then created a simple menu with each format in a new line. readline function receives an input which in our case it’s an index of a menu item and whenever the user enters the number associated to the format, we filled up $this-\u003eurl and $this-\u003ename.\nThe menu would be something like this:\n1: video/mp4; codecs=\"avc1.640028\" - 105345097 2: video/webm; codecs=\"vp9\" - 64217678 3: video/mp4; codecs=\"avc1.64002a\" - 113938770 4: video/webm; codecs=\"vp9\" - 107315439 5: video/mp4; codecs=\"av01.0.09M.08\" - 58147823 Which format do you want to download? (default: 1): | Note: File sizes are in byte, you can convert to MB by yourself.\nDownloader Here we are going to see how we can download a file and how to show a progress bar with PHP. Create a file under the src directory and call it Downloader.php:\n// src/Downloader.php \u003c?php namespace Downloader; class Downloader { private $provider; public function __construct(ProviderAbstract $provider) { $this-\u003eprovider = $provider; } /** * */ public function download() { $context = stream_context_create(); stream_context_set_params($context, ['notification' =\u003e [\\Downloader\\Downloader::class, 'streamCallback']]); $handler = @fopen($this-\u003eprovider-\u003egetUrl(), 'r', false, $context); if (!$handler) { throw new \\InvalidArgumentException(\"File not found\"); } file_put_contents($this-\u003eprovider-\u003egetName(), $handler); } /** * Stolen from https://www.php.net/manual/en/function.stream-notification-callback.php */ private function streamCallback($notification_code, $severity, $message, $message_code, $bytes_transferred, $bytes_max) { static $filesize = null; switch ($notification_code) { case STREAM_NOTIFY_RESOLVE: case STREAM_NOTIFY_AUTH_REQUIRED: case STREAM_NOTIFY_COMPLETED: case STREAM_NOTIFY_FAILURE: case STREAM_NOTIFY_AUTH_RESULT: break; case STREAM_NOTIFY_REDIRECTED: echo \"Being redirected to: \", $message, \"\\n\"; break; case STREAM_NOTIFY_CONNECT: echo \"Connected...\\n\"; break; case STREAM_NOTIFY_FILE_SIZE_IS: $filesize = $bytes_max; echo \"Filesize: \", $filesize, \"\\n\"; break; case STREAM_NOTIFY_MIME_TYPE_IS: echo \"Mime-type: \", $message, \"\\n\"; break; case STREAM_NOTIFY_PROGRESS: if ($bytes_transferred \u003e 0) { if (!isset($filesize)) { printf(\"\\rUnknown filesize.. %2d mb done..\", $bytes_transferred / 1024 / 1024); } else { $length = (int)(($bytes_transferred / $filesize) * 100); printf(\"\\r[%-100s] %d%% (%2d/%2d mb)\", str_repeat(\"=\", $length) . \"\u003e\", $length, ($bytes_transferred / 1024 / 1024), $filesize / 1024 / 1024); } } break; } } } This class is not as scary as it looks. Just notice how we passed a ProviderAbstract class to constructor. We will talk about the download method in the next section.\nWhat is Stream Context? In PHP, Stream Context is using to enhance or modify a stream, and it can pass to most file handling functions. From the PHP website:\nA context is a set of parameters and wrapper specific options which modify or enhance the behavior of a stream. Contexts are created using stream_context_create() and can be passed to most filesystem related stream creation functions (i.e. fopen(), file(), file_get_contents(), etc…).\nstream_context_set_params receives a stream context and an array of parameters. One of the parameters we can set is notification that is a function. This function will be called whenever our context state such changes. (see more: https://www.php.net/manual/en/function.stream-notification-callback.php)\nWe passed the URL we want to download and the context we made earlier to fopen, it will open the remote file in a read mode, and whenever the state of the file changes, it will call streamCallback method. Inside the streamCallback method, we checked for the notification type and printed the proper information about each notification.\nNow open sr/Command/Download.php and change the execute method as below:\n\u003c?php namespace Downloader\\Commands; use Downloader\\Downloader; use Downloader\\Factory; use Symfony\\Component\\Console\\Command\\Command; use Symfony\\Component\\Console\\Input\\InputArgument; use Symfony\\Component\\Console\\Input\\InputInterface; use Symfony\\Component\\Console\\Output\\OutputInterface; class Download extends Command { // ... protected function execute(InputInterface $input, OutputInterface $output) { $url = $input-\u003egetArgument($this-\u003earg); $downloader = new Downloader(Factory::make($url)); $downloader-\u003edownload(); return 0; } } Then open your terminal and try to download a youtube video:\n$ php index.php dl https://www.youtube.com/watch?v=wtl5UrrgU8c Video formats 1: video/mp4; codecs=\"avc1.640028\" - 39013359 2: video/webm; codecs=\"vp9\" - 35592706 3: video/mp4; codecs=\"av01.0.08M.08\" - 33395130 4: video/mp4; codecs=\"avc1.4d401f\" - 9282564 5: video/webm; codecs=\"vp9\" - 11742153 6: video/mp4; codecs=\"av01.0.05M.08\" - 19186717 7: video/mp4; codecs=\"avc1.4d401e\" - 5689359 8: video/webm; codecs=\"vp9\" - 6911794 9: video/mp4; codecs=\"av01.0.04M.08\" - 8974711 10: video/mp4; codecs=\"avc1.4d401e\" - 4401516 11: video/webm; codecs=\"vp9\" - 4782315 12: video/mp4; codecs=\"av01.0.01M.08\" - 5253856 13: video/mp4; codecs=\"avc1.4d4015\" - 2686265 14: video/webm; codecs=\"vp9\" - 3085549 15: video/mp4; codecs=\"av01.0.00M.08\" - 2907767 16: video/mp4; codecs=\"avc1.4d400c\" - 1378381 17: video/webm; codecs=\"vp9\" - 2921774 18: video/mp4; codecs=\"av01.0.00M.08\" - 2401547 19: audio/mp4; codecs=\"mp4a.40.2\" - 4881930 20: audio/webm; codecs=\"opus\" - 1962598 21: audio/webm; codecs=\"opus\" - 2514707 22: audio/webm; codecs=\"opus\" - 4880453 Which format do you want to download? (default: 1):10 Connected... Mime-type: video/mp4 Filesize: 4401516 [====================================================================================================\u003e] 100% ( 4/ 4 mb) Cool, right?\nDownload from a direct link So far, we can download youtube videos, but what about direct links such as http://example.com/file.mp3?\nBecause we used the Factory design pattern and Single Responsibility principle, it would be as easy as create a separate class for direct links.\nCreate Direct.php file under src/Providers directory with the following contents:\n\u003c?php namespace Downloader\\Providers; use Downloader\\ProviderAbstract; class Direct extends ProviderAbstract { public function init(string $url): void { $this-\u003eurl = $url; $this-\u003ename = basename($url); } } Because direct links are direct, the only thing we should do is to set $this-\u003eurl and $this-\u003ename. Now, open src/Factory.php and change it as below:\n\u003c?php // src/Factory.php namespace Downloader; use Downloader\\Providers\\Direct; use Downloader\\Providers\\Youtube; class Factory { public static function make(string $url): ProviderAbstract { switch (true) { case preg_match('%(?:youtube(?:-nocookie)?\\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?\u0026]v=)|youtu\\.be/)([^\"\u0026?/ ]{11})%i', $url, $matches): return new Youtube($url); default: return new Direct($url); } } } As you can see, we changed the default section to return a new object of Direct class.\nThat’s all we must do if we want to handle other sources.\nSummary Although PHP is not an excellent tool to write a downloader, we saw how we could manage and download a file from Youtube or a direct link. We learned about Stream Context and how we can use them of change or get information about a stream. We used the Factory design pattern and saw what the heck Single Responsibility means. Now it’s your time to use your imagination and creativity to extend this project. Maybe by adding more providers or how to make use of multithreading extensions such as https://github.com/krakjoe/parallel to make it more usable.\n","wordCount":"2220","inLanguage":"en","datePublished":"2020-04-16T21:37:50+08:00","dateModified":"2020-04-16T21:37:50+08:00","author":{"@type":"Person","name":"Saeed"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://keyboardsmash.dev/posts/how-download-youtube-videos-by-php/"},"publisher":{"@type":"Organization","name":"Saeed's Blog","logo":{"@type":"ImageObject","url":"https://keyboardsmash.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keyboardsmash.dev accesskey=h title="Saeed's Blog (Alt + H)">Saeed's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keyboardsmash.dev/about title=About><span>About</span></a></li><li><a href=https://keyboardsmash.dev/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How to write a PHP Youtube video downloader</h1><div class=post-meta><span title='2020-04-16 21:37:50 +0800 +0800'>April 16, 2020</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Saeed</div></header><div class=post-content><p>PHP is not the best language for writing a download manager, but in this article, we are going to learn how we can download videos from Youtube. Because PHP does not support multithreading, we cannot make a proper download manager that split the file into several chunks and download it concurrently. There are some ways to add multithreading to PHP, but for the sake of this article, we won&rsquo;t go through those ways and will stick to single threading.</p><p>At the end of this article, we have a command called <code>dl</code>, and it gets a Youtube video URL to download.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ php index.php dl https://www.youtube.com/watch?v<span style=color:#f92672>=</span>XXXXXXXXX
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Video formats
</span></span><span style=display:flex><span>1: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.640028&#34;</span> - <span style=color:#ae81ff>39013359</span>
</span></span><span style=display:flex><span>2: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>35592706</span>
</span></span><span style=display:flex><span>3: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.08M.08&#34;</span> - <span style=color:#ae81ff>33395130</span>
</span></span><span style=display:flex><span>4: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401f&#34;</span> - <span style=color:#ae81ff>9282564</span>
</span></span><span style=display:flex><span>5: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>11742153</span>
</span></span><span style=display:flex><span>6: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.05M.08&#34;</span> - <span style=color:#ae81ff>19186717</span>
</span></span><span style=display:flex><span>7: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401e&#34;</span> - <span style=color:#ae81ff>5689359</span>
</span></span><span style=display:flex><span>8: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>6911794</span>
</span></span><span style=display:flex><span>9: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.04M.08&#34;</span> - <span style=color:#ae81ff>8974711</span>
</span></span><span style=display:flex><span>10: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401e&#34;</span> - <span style=color:#ae81ff>4401516</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Which format <span style=color:#66d9ef>do</span> you want to download? <span style=color:#f92672>(</span>default: 1<span style=color:#f92672>)</span>:10
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connected...
</span></span><span style=display:flex><span>Mime-type: video/mp4
</span></span><span style=display:flex><span>Filesize: <span style=color:#ae81ff>4401516</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[==============================================</span>&gt;<span style=color:#f92672>]</span> 100% <span style=color:#f92672>(</span> 4/ <span style=color:#ae81ff>4</span> mb<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=what-we-will-learn-by-the-end-of-this-article>What we will learn by the end of this article:<a hidden class=anchor aria-hidden=true href=#what-we-will-learn-by-the-end-of-this-article>#</a></h3><ul><li>How to create a command-line application</li><li>How to use the Factory design pattern</li><li>How to get information about a Youtube video such as formats, titles, etc.</li><li>How to download a file with PHP with a progress bar</li></ul><h3 id=create-the-project>Create the project<a hidden class=anchor aria-hidden=true href=#create-the-project>#</a></h3><p>create a new directory and run <code>composer init</code> inside it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir youtueb-downloader <span style=color:#f92672>&amp;&amp;</span> cd youtueb-downloader
</span></span><span style=display:flex><span>$ composer init
</span></span></code></pre></div><p>After running <code>composer init‍</code> you need to answer a few questions. This command creates a <code>composer.json</code> file inside <code>youtube-downloader</code> directory.</p><h3 id=install-dependencies>Install dependencies<a hidden class=anchor aria-hidden=true href=#install-dependencies>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ composer require symfony/console
</span></span><span style=display:flex><span>$ composer require smoqadam/youtube-video-info:dev-master
</span></span></code></pre></div><ul><li><p><code>symfony/console</code> is a great package that helps us to create a command-line application and make it easier to handle input and outputs.</p></li><li><p><code>smoqadam/youtube-video-info</code> gives us information about a Youtube video. The information such as video formats, subtitles, download URL, title, etc.</p></li></ul><h3 id=autoloading>autoloading<a hidden class=anchor aria-hidden=true href=#autoloading>#</a></h3><p>Create a directory and call it <code>src</code> we will put all of our classes inside this directory. For taking advantage of composer autloading, open <code>composer.json</code> and add <code>autoload</code> sectoin such as below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;autoload&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;psr-4&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Downloader\\&#34;</span>: <span style=color:#e6db74>&#34;src&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Downloader</code> is our chosen namespace for this project, and whenever the composer wants to load a class within this namespace, it looks inside the <code>src</code> directory.</p><p>You can find more information about PSR4 <a href=LINK>here</a>.</p><h3 id=handle-command-line-arguments>Handle Command Line arguments<a hidden class=anchor aria-hidden=true href=#handle-command-line-arguments>#</a></h3><p>Create a <code>Download.php</code> file inside the <code>src/Commands</code> directory and with the following content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// src/Commands/Download.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader\Commands</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Downloader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Factory</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Command\Command</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputArgument</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Output\OutputInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Download</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Command</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> $defaultName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;dl&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $arg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;url&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>configure</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setDescription</span>(<span style=color:#e6db74>&#34;URL&#34;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addArgument</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>arg</span>, <span style=color:#a6e22e>InputArgument</span><span style=color:#f92672>::</span><span style=color:#a6e22e>REQUIRED</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>InputInterface</span> $input, <span style=color:#a6e22e>OutputInterface</span> $output)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $url <span style=color:#f92672>=</span> $input<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getArgument</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>arg</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $outpu<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#34;&lt;info&gt;</span><span style=color:#e6db74>{</span>$url<span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/info&gt;&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Download</code> class extended <code>Command</code> from the <code>symfony/console</code> package, which gives us many features to handle command-line input and outputs.</p><ul><li><code>$defaultName</code> is the name of our command.</li><li><code>configure</code> method is using to config our command, such as add description, add arguments, options, and so on.</li><li>Inside the <code>configure</code> method, we can configure the <code>dl</code> command, for example, add a description, add arguments, options, and many more.</li><li>And finally, <code>execute</code> will call when we run the <code>dl</code> command from CLI. It receives two parameters, <code>$input</code> for handling the inputs such as options and arguments, and <code>$output</code> for managing the output. As you can see, we used <code>&lt;info>&lt;/info></code> tags in the write method to colorize the output.</li></ul><p>Let&rsquo;s make our <code>dl</code> command work by creating a <code>index.php</code> file under root directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// index.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Commands\Download</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Application</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#e6db74>&#39;vendor/autoload.php&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Symfony/console application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$app <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application</span>();
</span></span><span style=display:flex><span>$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Download</span>());
</span></span><span style=display:flex><span>$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>run</span>();
</span></span></code></pre></div><p><code>Application</code> is the main class responsible for handling the command line application, so to make our <code>dl</code> command work, we must use the <code>add</code> method to pass a new instance of <code>Download</code> class to it.</p><p>Now, open your terminal and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ PHP index.php dl http://example.com
</span></span></code></pre></div><p>you should see <a href=http://example.com>http://example.com</a> in green color as output.</p><h2 id=downloader>Downloader<a hidden class=anchor aria-hidden=true href=#downloader>#</a></h2><p>In this section, we are going to make a downloader class. This class receives a URL and a file name, and it will download the file for us. But before we create our Downloader class, let&rsquo;s think about how we can make it extendable? By extendable, I mean how we can have a Downloader that downloads files from different sources such as Youtube or Vimeo videos or may a direct link.</p><p>We know that Youtube videos have different qualities, and each quality has a different download link. So before we can download a video, we must get all qualities and ask users which quality they want to download. But this process will be different if they&rsquo;re going to download from Vimeo or a direct link.</p><p>In the SOLID principle, <strong>S</strong> is for <strong>Single responsibility</strong>, which means each class must do only one thing. With that explanation, we need to have different classes for different sources.</p><p>To achieve this, we can use <strong>Factory</strong> design pattern to instantiate a new object based on the URL that the user wants to download.</p><p>For example, if it was a Youtube URL, it will return a new object from <code>Youtube</code> class and so on.</p><p><code>Factory.php</code> class under <code>src/</code> directory would be something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// src/Factory.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Factory</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>make</span>(<span style=color:#a6e22e>string</span> $url)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProviderAbstract</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> (<span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;%(?:youtube(?:-nocookie)?\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&amp;]v=)|youtu\.be/)([^&#34;&amp;?/ ]{11})%i&#39;</span>, $url, $matches)<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Youtube</span>($url);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Download link does not support&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Factory</strong> Design pattern is creational pattern that create a different object based on some conditions. In our case, we checked the <code>$url</code> and if it was a Yoututbe link, it returns a new instance of <code>Yoututbe</code> class, otherwise it throws an <code>Exception</code>.</p><h3 id=handle-different-sources>Handle different sources<a hidden class=anchor aria-hidden=true href=#handle-different-sources>#</a></h3><p>As we saw earlier, we decided to let our app download from different sources, but these sources or providers must follow some rules to prevent chaos and make it easier to extend and debug. We define our rules inside <code>ProviderAbstract</code>, and every provider (e.g., Youtube class) must extend from this class, and they must implement the <code>init</code> method.</p><h4 id=providerabstract>ProviderAbstract<a hidden class=anchor aria-hidden=true href=#providerabstract>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// src/ProviderAbstract.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProviderAbstract</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> $url;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> $name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($url)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>init</span>($url);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUrl</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>url</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>(<span style=color:#a6e22e>string</span> $url)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Every provider must initialize and prepare the download link and output file name inside the <code>init</code> method.</p><h3 id=youtube-provider>Youtube provider<a hidden class=anchor aria-hidden=true href=#youtube-provider>#</a></h3><p>Create a directory under <code>src</code> and call it <code>Providers</code> then create a file <code>Youtube.php</code> inside it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// src/Providers/Youtube.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader\Providers</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\ProviderAbstract</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Smoqadam\Video</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Youtube</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ProviderAbstract</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> $pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;%(?:youtube(?:-nocookie)?\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&amp;]v=)|youtu\.be/)([^&#34;&amp;?/ ]{11})%i&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>(<span style=color:#a6e22e>string</span> $url)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $video <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Video</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getVideoId</span>($url));
</span></span><span style=display:flex><span>        <span style=color:#75715e>// fetch all formats and qualities 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $formats <span style=color:#f92672>=</span> $video<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFormats</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Video formats&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// print a simple menu by each quality in a new line
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>foreach</span> ($formats <span style=color:#66d9ef>as</span> $index <span style=color:#f92672>=&gt;</span> $format) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%d: %s - %d&#34;</span>, $index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, $format<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMimeType</span>(), $format<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getSize</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// wait for user to enter index number associated to a menu item
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Which format do you want to download? (default: 1):&#34;</span>);
</span></span><span style=display:flex><span>        $i <span style=color:#f92672>=</span> <span style=color:#a6e22e>readline</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$i) {
</span></span><span style=display:flex><span>            $i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $format <span style=color:#f92672>=</span> $formats[$i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>        <span style=color:#75715e>// set url and name
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> $format<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUrl</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $video<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getDetails</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getTitle</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getVideoId</span>($url)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>preg_match</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>pattern</span>, $url, $match);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $match[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Youtube</code> class extended from <code>ProviderAbstract</code>, which means it must implement the <code>init</code> method. Inside <code>init</code>, we took advantage of <code>smoqadam/youtube-video-info</code> package to parse a youtube video. Then created a simple menu with each format in a new line. <code>readline</code> function receives an input which in our case it&rsquo;s an index of a menu item and whenever the user enters the number associated to the format, we filled up <code>$this->url</code> and <code>$this->name</code>.</p><p>The menu would be something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> 1: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.640028&#34;</span> - <span style=color:#ae81ff>105345097</span>
</span></span><span style=display:flex><span> 2: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>64217678</span>
</span></span><span style=display:flex><span> 3: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.64002a&#34;</span> - <span style=color:#ae81ff>113938770</span>
</span></span><span style=display:flex><span> 4: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>107315439</span>
</span></span><span style=display:flex><span> 5: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.09M.08&#34;</span> - <span style=color:#ae81ff>58147823</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Which format <span style=color:#66d9ef>do</span> you want to download? <span style=color:#f92672>(</span>default: 1<span style=color:#f92672>)</span>:
</span></span></code></pre></div><p>| Note: File sizes are in byte, you can convert to MB by yourself.</p><h3 id=downloader-1>Downloader<a hidden class=anchor aria-hidden=true href=#downloader-1>#</a></h3><p>Here we are going to see how we can download a file and how to show a progress bar with PHP. Create a file under the <code>src</code> directory and call it <code>Downloader.php</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// src/Downloader.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Downloader</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $provider;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(<span style=color:#a6e22e>ProviderAbstract</span> $provider)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>provider</span> <span style=color:#f92672>=</span> $provider;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>download</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $context <span style=color:#f92672>=</span> <span style=color:#a6e22e>stream_context_create</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stream_context_set_params</span>($context, [<span style=color:#e6db74>&#39;notification&#39;</span> <span style=color:#f92672>=&gt;</span> [<span style=color:#a6e22e>\Downloader\Downloader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;streamCallback&#39;</span>]]);
</span></span><span style=display:flex><span>        $handler <span style=color:#f92672>=</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>fopen</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUrl</span>(), <span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#66d9ef>false</span>, $context);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$handler) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\InvalidArgumentException</span>(<span style=color:#e6db74>&#34;File not found&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>file_put_contents</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getName</span>(), $handler);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     * Stolen from https://www.php.net/manual/en/function.stream-notification-callback.php
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>streamCallback</span>($notification_code, $severity, $message, $message_code, $bytes_transferred, $bytes_max)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> $filesize <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> ($notification_code) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_RESOLVE</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_AUTH_REQUIRED</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_COMPLETED</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_FAILURE</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_AUTH_RESULT</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_REDIRECTED</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Being redirected to: &#34;</span>, $message, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_CONNECT</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Connected...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_FILE_SIZE_IS</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $filesize <span style=color:#f92672>=</span> $bytes_max;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Filesize: &#34;</span>, $filesize, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_MIME_TYPE_IS</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Mime-type: &#34;</span>, $message, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>STREAM_NOTIFY_PROGRESS</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> ($bytes_transferred <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($filesize)) {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r</span><span style=color:#e6db74>Unknown filesize.. %2d mb done..&#34;</span>, $bytes_transferred <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        $length <span style=color:#f92672>=</span> (<span style=color:#a6e22e>int</span>)(($bytes_transferred <span style=color:#f92672>/</span> $filesize) <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r</span><span style=color:#e6db74>[%-100s] %d%% (%2d/%2d mb)&#34;</span>, <span style=color:#a6e22e>str_repeat</span>(<span style=color:#e6db74>&#34;=&#34;</span>, $length) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>, $length, ($bytes_transferred <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span>), $filesize <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This class is not as scary as it looks. Just notice how we passed a <code>ProviderAbstract</code> class to constructor. We will talk about the <code>download</code> method in the next section.</p><h4 id=what-is-stream-context>What is Stream Context?<a hidden class=anchor aria-hidden=true href=#what-is-stream-context>#</a></h4><p>In PHP, <a href=https://www.php.net/manual/en/stream.contexts.php>Stream Context</a> is using to enhance or modify a stream, and it can pass to most file handling functions. From the PHP website:</p><blockquote><p>A context is a set of parameters and wrapper specific options which modify or enhance the behavior of a stream. Contexts are created using stream_context_create() and can be passed to most filesystem related stream creation functions (i.e. fopen(), file(), file_get_contents(), etc&mldr;).</p></blockquote><p><code>stream_context_set_params</code> receives a stream context and an array of parameters. One of the parameters we can set is <code>notification</code> that is a function. This function will be called whenever our context state such changes. (see more: <a href=https://www.php.net/manual/en/function.stream-notification-callback.php>https://www.php.net/manual/en/function.stream-notification-callback.php</a>)</p><p>We passed the URL we want to download and the context we made earlier to <code>fopen</code>, it will open the remote file in a read mode, and whenever the state of the file changes, it will call <code>streamCallback</code> method. Inside the <code>streamCallback</code> method, we checked for the notification type and printed the proper information about each notification.</p><p>Now open <code>sr/Command/Download.php</code> and change the <code>execute</code> method as below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader\Commands</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Downloader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Factory</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Command\Command</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputArgument</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Output\OutputInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Download</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Command</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>InputInterface</span> $input, <span style=color:#a6e22e>OutputInterface</span> $output)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $url <span style=color:#f92672>=</span> $input<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getArgument</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>arg</span>);
</span></span><span style=display:flex><span>        $downloader <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Downloader</span>(<span style=color:#a6e22e>Factory</span><span style=color:#f92672>::</span><span style=color:#a6e22e>make</span>($url));
</span></span><span style=display:flex><span>        $downloader<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>download</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then open your terminal and try to download a youtube video:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ php index.php dl https://www.youtube.com/watch?v<span style=color:#f92672>=</span>wtl5UrrgU8c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Video formats
</span></span><span style=display:flex><span>1: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.640028&#34;</span> - <span style=color:#ae81ff>39013359</span>
</span></span><span style=display:flex><span>2: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>35592706</span>
</span></span><span style=display:flex><span>3: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.08M.08&#34;</span> - <span style=color:#ae81ff>33395130</span>
</span></span><span style=display:flex><span>4: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401f&#34;</span> - <span style=color:#ae81ff>9282564</span>
</span></span><span style=display:flex><span>5: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>11742153</span>
</span></span><span style=display:flex><span>6: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.05M.08&#34;</span> - <span style=color:#ae81ff>19186717</span>
</span></span><span style=display:flex><span>7: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401e&#34;</span> - <span style=color:#ae81ff>5689359</span>
</span></span><span style=display:flex><span>8: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>6911794</span>
</span></span><span style=display:flex><span>9: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.04M.08&#34;</span> - <span style=color:#ae81ff>8974711</span>
</span></span><span style=display:flex><span>10: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d401e&#34;</span> - <span style=color:#ae81ff>4401516</span>
</span></span><span style=display:flex><span>11: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>4782315</span>
</span></span><span style=display:flex><span>12: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.01M.08&#34;</span> - <span style=color:#ae81ff>5253856</span>
</span></span><span style=display:flex><span>13: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d4015&#34;</span> - <span style=color:#ae81ff>2686265</span>
</span></span><span style=display:flex><span>14: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>3085549</span>
</span></span><span style=display:flex><span>15: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.00M.08&#34;</span> - <span style=color:#ae81ff>2907767</span>
</span></span><span style=display:flex><span>16: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;avc1.4d400c&#34;</span> - <span style=color:#ae81ff>1378381</span>
</span></span><span style=display:flex><span>17: video/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vp9&#34;</span> - <span style=color:#ae81ff>2921774</span>
</span></span><span style=display:flex><span>18: video/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av01.0.00M.08&#34;</span> - <span style=color:#ae81ff>2401547</span>
</span></span><span style=display:flex><span>19: audio/mp4; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mp4a.40.2&#34;</span> - <span style=color:#ae81ff>4881930</span>
</span></span><span style=display:flex><span>20: audio/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;opus&#34;</span> - <span style=color:#ae81ff>1962598</span>
</span></span><span style=display:flex><span>21: audio/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;opus&#34;</span> - <span style=color:#ae81ff>2514707</span>
</span></span><span style=display:flex><span>22: audio/webm; codecs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;opus&#34;</span> - <span style=color:#ae81ff>4880453</span>
</span></span><span style=display:flex><span>Which format <span style=color:#66d9ef>do</span> you want to download? <span style=color:#f92672>(</span>default: 1<span style=color:#f92672>)</span>:10
</span></span><span style=display:flex><span>Connected...
</span></span><span style=display:flex><span>Mime-type: video/mp4
</span></span><span style=display:flex><span>Filesize: <span style=color:#ae81ff>4401516</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[====================================================================================================</span>&gt;<span style=color:#f92672>]</span> 100% <span style=color:#f92672>(</span> 4/ <span style=color:#ae81ff>4</span> mb<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Cool, right?</p><h3 id=download-from-a-direct-link>Download from a direct link<a hidden class=anchor aria-hidden=true href=#download-from-a-direct-link>#</a></h3><p>So far, we can download youtube videos, but what about direct links such as <a href=http://example.com/file.mp3>http://example.com/file.mp3</a>?</p><p>Because we used the Factory design pattern and Single Responsibility principle, it would be as easy as create a separate class for direct links.</p><p>Create <code>Direct.php</code> file under <code>src/Providers</code> directory with the following contents:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader\Providers</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\ProviderAbstract</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Direct</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ProviderAbstract</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>(<span style=color:#a6e22e>string</span> $url)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> $url;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>basename</span>($url);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Because direct links are <em>direct</em>, the only thing we should do is to set <code>$this->url</code> and <code>$this->name</code>. Now, open <code>src/Factory.php</code> and change it as below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// src/Factory.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Downloader</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Providers\Direct</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Downloader\Providers\Youtube</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Factory</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>make</span>(<span style=color:#a6e22e>string</span> $url)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProviderAbstract</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> (<span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;%(?:youtube(?:-nocookie)?\.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&amp;]v=)|youtu\.be/)([^&#34;&amp;?/ ]{11})%i&#39;</span>, $url, $matches)<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Youtube</span>($url);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Direct</span>($url);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you can see, we changed the <code>default</code> section to return a new object of <code>Direct</code> class.</p><p>That&rsquo;s all we must do if we want to handle other sources.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>Although PHP is not an excellent tool to write a downloader, we saw how we could manage and download a file from Youtube or a direct link. We learned about <strong>Stream Context</strong> and how we can use them of change or get information about a stream. We used the Factory design pattern and saw what the heck <strong>Single Responsibility</strong> means. Now it&rsquo;s your time to use your imagination and creativity to extend this project. Maybe by adding more providers or how to make use of multithreading extensions such as <a href=https://github.com/krakjoe/parallel>https://github.com/krakjoe/parallel</a> to make it more usable.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://keyboardsmash.dev>Saeed's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>